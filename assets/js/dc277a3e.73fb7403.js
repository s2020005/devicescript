"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1707],{35318:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(27378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(o,".").concat(m)]||p[m]||u[m]||i;return n?a.createElement(g,l(l({ref:t},d),{},{components:n})):a.createElement(g,l({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[p]="string"==typeof e?e:r,l[1]=s;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},59122:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(25773),r=(n(27378),n(35318));const i={pagination_prev:null,pagination_next:null,description:"DeviceScript client for Jacdac USB Bridge service"},l="UsbBridge",s={unversionedId:"api/clients/usbbridge",id:"api/clients/usbbridge",title:"UsbBridge",description:"DeviceScript client for Jacdac USB Bridge service",source:"@site/docs/api/clients/usbbridge.md",sourceDirName:"api/clients",slug:"/api/clients/usbbridge",permalink:"/devicescript/api/clients/usbbridge",draft:!1,tags:[],version:"current",frontMatter:{pagination_prev:null,pagination_next:null,description:"DeviceScript client for Jacdac USB Bridge service"},sidebar:"tutorialSidebar"},o={},c=[{value:"Commands",id:"commands",level:2},{value:"disablePackets",id:"disablepackets",level:3},{value:"enablePackets",id:"enablepackets",level:3},{value:"disableLog",id:"disablelog",level:3},{value:"enableLog",id:"enablelog",level:3}],d={toc:c},p="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"usbbridge"},"UsbBridge"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This service is rc and may change in the future.")),(0,r.kt)("p",null,"This service is normally not announced or otherwise exposed on the serial bus.\nIt is used to communicate with a USB-Jacdac bridge at the USB layer.\nThe host sends broadcast packets to this service to control the link layer.\nThe device responds with broadcast reports (no-one else does that).\nThese packets are not forwarded to the UART Jacdac line."),(0,r.kt)("p",null,"Packets are sent over USB Serial (CDC).\nThe host shall set the CDC to 1Mbaud 8N1\n(even though in some cases the USB interface is connected directly to the MCU and line settings are\nignored)."),(0,r.kt)("p",null,"The CDC line carries both Jacdac frames and serial logging output.\nJacdac frames have valid CRC and are framed by delimeter characters and possibly fragmented."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"0xFE")," is used as a framing byte.\nNote that bytes ",(0,r.kt)("inlineCode",{parentName:"p"},"0xF8"),"-",(0,r.kt)("inlineCode",{parentName:"p"},"0xFF")," are always invalid UTF-8.\n",(0,r.kt)("inlineCode",{parentName:"p"},"0xFF")," occurs relatively often in Jacdac packets, so is not used for framing."),(0,r.kt)("p",null,"The following sequences are supported:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xF8")," - literal 0xFE"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xF9")," - reserved; ignore"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xFA")," - indicates that some serial logs were dropped at this point"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xFB")," - indicates that some Jacdac frames were dropped at this point"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xFC")," - Jacdac frame start"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"0xFE 0xFD")," - Jacdac frame end")),(0,r.kt)("p",null,"0xFE followed by any other byte:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"in serial, should be treated as literal 0xFE (and the byte as itself, unless it's 0xFE)"),(0,r.kt)("li",{parentName:"ul"},"in frame data, should terminate the current frame fragment,\nand ideally have all data (incl. fragment start) in the current frame fragment treated as serial")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"client for ",(0,r.kt)("a",{parentName:"li",href:"https://microsoft.github.io/jacdac-docs/services/usbbridge/"},"USB Bridge service")),(0,r.kt)("li",{parentName:"ul"},"inherits Role")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { UsbBridge } from "@devicescript/core"\n\nconst usbBridge = new UsbBridge()\n')),(0,r.kt)("h2",{id:"commands"},"Commands"),(0,r.kt)("h3",{id:"disablepackets"},"disablePackets"),(0,r.kt)("p",null,"Disables forwarding of Jacdac packets."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"skip no-run",skip:!0,"no-run":!0},"usbBridge.disablePackets(): Promise<void>\n")),(0,r.kt)("h3",{id:"enablepackets"},"enablePackets"),(0,r.kt)("p",null,"Enables forwarding of Jacdac packets."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"skip no-run",skip:!0,"no-run":!0},"usbBridge.enablePackets(): Promise<void>\n")),(0,r.kt)("h3",{id:"disablelog"},"disableLog"),(0,r.kt)("p",null,"Disables forwarding of serial log messages."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"skip no-run",skip:!0,"no-run":!0},"usbBridge.disableLog(): Promise<void>\n")),(0,r.kt)("h3",{id:"enablelog"},"enableLog"),(0,r.kt)("p",null,"Enables forwarding of serial log messages."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"skip no-run",skip:!0,"no-run":!0},"usbBridge.enableLog(): Promise<void>\n")),(0,r.kt)("p",null))}u.isMDXComponent=!0}}]);